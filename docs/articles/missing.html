<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Missing data • finalfit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Missing data">
<meta property="og:description" content="finalfit">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">finalfit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/finalfit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/all_plots_examples.html">All plots examples</a>
    </li>
    <li>
      <a href="../articles/all_tables_examples.html">All tables examples</a>
    </li>
    <li>
      <a href="../articles/bootstrap.html">Bootstrap simulation for model prediction</a>
    </li>
    <li>
      <a href="../articles/data_prep.html">Preparing data for finalfit</a>
    </li>
    <li>
      <a href="../articles/export.html">Exporting tables and plots</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Time-to-event (Survival)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ewenharrison/finalfit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Missing data</h1>
                        <h4 data-toc-skip class="author">Ewen
Harrison</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ewenharrison/finalfit/blob/HEAD/vignettes/missing.Rmd" class="external-link"><code>vignettes/missing.Rmd</code></a></small>
      <div class="hidden name"><code>missing.Rmd</code></div>

    </div>

    
    
<p>As a journal editor, I often receive studies in which the
investigators fail to describe, analyse, or even acknowledge missing
data. This is frustrating, as it is often of the utmost importance.
Conclusions may (and do) change when missing data is accounted for. A
few seem to not even appreciate that in conventional regression, only
rows with complete data are included.</p>
<p>These are the five steps to ensuring missing data are correctly
identified and appropriately dealt with:</p>
<ol style="list-style-type: decimal">
<li>Ensure your data are coded correctly.</li>
<li>Identify missing values within each variable.</li>
<li>Look for patterns of missingness.</li>
<li>Check for associations between missing and observed data.</li>
<li>Decide how to handle missing data.</li>
</ol>
<p><code>finalfit</code> includes a number of functions to help with
this.</p>
<div class="section level2">
<h2 id="some-confusing-terminology">Some confusing terminology<a class="anchor" aria-label="anchor" href="#some-confusing-terminology"></a>
</h2>
<p>But first there are some terms which easy to mix up. These are
important as they describe the mechanism of missingness and this
determines how you can handle the missing data.</p>
<div class="section level3">
<h3 id="missing-completely-at-random-mcar">Missing completely at random (MCAR)<a class="anchor" aria-label="anchor" href="#missing-completely-at-random-mcar"></a>
</h3>
<p>As it says, values are randomly missing from your dataset. Missing
data values do not relate to any other data in the dataset and there is
no pattern to the actual values of the missing data themselves.</p>
<p>For instance, when smoking status is not recorded in a random subset
of patients.</p>
<p>This is easy to handle, but unfortunately, data are almost never
missing completely at random.</p>
</div>
<div class="section level3">
<h3 id="missing-at-random-mar">Missing at random (MAR)<a class="anchor" aria-label="anchor" href="#missing-at-random-mar"></a>
</h3>
<p>This is confusing and would be better stated as missing conditionally
at random. Here, missing data do have a relationship with other
variables in the dataset. However, the actual values that are missing
are random.</p>
<p>For example, smoking status is not documented in female patients
because the doctor was too shy to ask. Yes ok, not that realistic!</p>
</div>
<div class="section level3">
<h3 id="missing-not-at-random-mnar">Missing not at random (MNAR)<a class="anchor" aria-label="anchor" href="#missing-not-at-random-mnar"></a>
</h3>
<p>The pattern of missingness is related to other variables in the
dataset, but in addition, the values of the missing data are not
random.</p>
<p>For example, when smoking status is not recorded in patients admitted
as an emergency, who are also more likely to have worse outcomes from
surgery.</p>
<p>Missing not at random data are important, can alter your conclusions,
and are the most difficult to diagnose and handle. They can only be
detected by collecting and examining some of the missing data. This is
often difficult or impossible to do.</p>
<p>How you deal with missing data is dependent on the type of
missingness. Once you know this, then you can sort it.</p>
<p>More on this below.</p>
</div>
</div>
<div class="section level2">
<h2 id="ensure-your-data-are-coded-correctly-ff_glimpse">1. Ensure your data are coded correctly:
<code>ff_glimpse</code><a class="anchor" aria-label="anchor" href="#ensure-your-data-are-coded-correctly-ff_glimpse"></a>
</h2>
<p>While clearly obvious, this step is often ignored in the rush to get
results. The first step in any analysis is robust data cleaning and
coding. Lots of packages have a glimpse-type function and
<code>finalfit</code> is no different. This function has three specific
goals:</p>
<ol style="list-style-type: decimal">
<li>Ensure all factors and numerics are correctly assigned. That is the
commonest reason to get an error with a finalfit function. You think
you’re using a factor variable, but in fact it is incorrectly coded as a
continuous numeric.</li>
<li>Ensure you know which variables have missing data. This presumes
missing values are correctly assigned NA. See here for more details if
you are unsure.</li>
<li>Ensure factor levels and variable labels are assigned
correctly.</li>
</ol>
<div class="section level3">
<h3 id="example-scenario">Example scenario<a class="anchor" aria-label="anchor" href="#example-scenario"></a>
</h3>
<p>Using the <code>colon_s</code> cancer dataset that comes with
<code>finalfit</code>, we are interested in exploring the association
between a cancer obstructing the bowel and 5-year survival, accounting
for other patient and disease characteristics.</p>
<p>For demonstration purposes, we will create random MCAR and MAR
smoking variables to the dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make sure finalfit is up-to-date </span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"finalfit"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ewenharrison/finalfit" class="external-link">finalfit</a></span><span class="op">)</span> 

<span class="co"># Create some extra missing data</span>
<span class="co">## Smoking missing completely at random</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">colon_s</span><span class="op">$</span><span class="va">smoking_mcar</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Smoker"</span>, <span class="st">"Non-smoker"</span>, <span class="cn">NA</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">colon_s</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, 
    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/ff_label.html">ff_label</a></span><span class="op">(</span><span class="st">"Smoking (MCAR)"</span><span class="op">)</span>

<span class="co">## Smoking missing conditional on patient sex</span>
<span class="va">colon_s</span><span class="op">$</span><span class="va">smoking_mar</span><span class="op">[</span><span class="va">colon_s</span><span class="op">$</span><span class="va">sex.factor</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">]</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Smoker"</span>, <span class="st">"Non-smoker"</span>, <span class="cn">NA</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">colon_s</span><span class="op">$</span><span class="va">sex.factor</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span>, 
    replace <span class="op">=</span> <span class="cn">TRUE</span>,
    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>

<span class="va">colon_s</span><span class="op">$</span><span class="va">smoking_mar</span><span class="op">[</span><span class="va">colon_s</span><span class="op">$</span><span class="va">sex.factor</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">]</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Smoker"</span>, <span class="st">"Non-smoker"</span>, <span class="cn">NA</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">colon_s</span><span class="op">$</span><span class="va">sex.factor</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span>, 
    replace<span class="op">=</span><span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.75</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">colon_s</span><span class="op">$</span><span class="va">smoking_mar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">colon_s</span><span class="op">$</span><span class="va">smoking_mar</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/ff_label.html">ff_label</a></span><span class="op">(</span><span class="st">"Smoking (MAR)"</span><span class="op">)</span>

<span class="co"># Examine with ff_glimpse</span>
<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>,  
  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"mort_5yr"</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ff_glimpse.html">ff_glimpse</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span>
<span class="co">#&gt; $Continuous</span>
<span class="co">#&gt;             label var_type   n missing_n missing_percent mean   sd  min</span>
<span class="co">#&gt; age   Age (years)    &lt;dbl&gt; 929         0             0.0 59.8 11.9 18.0</span>
<span class="co">#&gt; nodes       nodes    &lt;dbl&gt; 911        18             1.9  3.7  3.6  0.0</span>
<span class="co">#&gt;       quartile_25 median quartile_75  max</span>
<span class="co">#&gt; age          53.0   61.0        69.0 85.0</span>
<span class="co">#&gt; nodes         1.0    2.0         5.0 33.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Categorical</span>
<span class="co">#&gt;                            label var_type   n missing_n missing_percent</span>
<span class="co">#&gt; mort_5yr        Mortality 5 year    &lt;fct&gt; 915        14             1.5</span>
<span class="co">#&gt; sex.factor                   Sex    &lt;fct&gt; 929         0             0.0</span>
<span class="co">#&gt; obstruct.factor      Obstruction    &lt;fct&gt; 908        21             2.3</span>
<span class="co">#&gt; smoking_mcar      Smoking (MCAR)    &lt;fct&gt; 828       101            10.9</span>
<span class="co">#&gt; smoking_mar        Smoking (MAR)    &lt;fct&gt; 719       210            22.6</span>
<span class="co">#&gt;                 levels_n                              levels  levels_count</span>
<span class="co">#&gt; mort_5yr               2        "Alive", "Died", "(Missing)"  511, 404, 14</span>
<span class="co">#&gt; sex.factor             2       "Female", "Male", "(Missing)"      445, 484</span>
<span class="co">#&gt; obstruct.factor        2            "No", "Yes", "(Missing)"  732, 176, 21</span>
<span class="co">#&gt; smoking_mcar           2 "Non-smoker", "Smoker", "(Missing)" 645, 183, 101</span>
<span class="co">#&gt; smoking_mar            2 "Non-smoker", "Smoker", "(Missing)" 591, 128, 210</span>
<span class="co">#&gt;                   levels_percent</span>
<span class="co">#&gt; mort_5yr        55.0, 43.5,  1.5</span>
<span class="co">#&gt; sex.factor                48, 52</span>
<span class="co">#&gt; obstruct.factor 78.8, 18.9,  2.3</span>
<span class="co">#&gt; smoking_mcar          69, 20, 11</span>
<span class="co">#&gt; smoking_mar           64, 14, 23</span></code></pre></div>
<p>The function summarises a data frame or tibble by numeric
(continuous) variables and factor (discrete) variables. The dependent
and explanatory are for convenience. Pass either or neither e.g. to
summarise data frame or tibble:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/ff_glimpse.html">ff_glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>It doesn’t present well if you have factors with lots of levels, so
you may want to remove these.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ff_glimpse.html">ff_glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Use this to check that the variables are all assigned and behaving as
expected. The proportion of missing data can be seen, e.g. smoking_mar
has 23% missing data.</p>
</div>
</div>
<div class="section level2">
<h2 id="identify-missing-values-in-each-variable-missing_plot">2. Identify missing values in each variable:
<code>missing_plot</code><a class="anchor" aria-label="anchor" href="#identify-missing-values-in-each-variable-missing_plot"></a>
</h2>
<p>In detecting patterns of missingness, this plot is useful. Row number
is on the x-axis and all included variables are on the y-axis.
Associations between missingness and observations can be easily seen, as
can relationships of missingness between variables.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/missing_plot.html">missing_plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/missing_values-1024x312.png" class="external-link"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/missing_values-1024x312.png" alt="" width="700"></a></p>
<p>It was only when writing this post that I discovered the amazing
package, <a href="https://naniar.njtierney.com/" class="external-link">naniar</a>. This
package is recommended and provides lots of great visualisations for
missing data.</p>
</div>
<div class="section level2">
<h2 id="look-for-patterns-of-missingness-missing_pattern">3. Look for patterns of missingness:
<code>missing_pattern</code><a class="anchor" aria-label="anchor" href="#look-for-patterns-of-missingness-missing_pattern"></a>
</h2>
<p><code>missing_pattern</code> simply wraps
<code><a href="https://amices.org/mice/reference/md.pattern.html" class="external-link">mice::md.pattern</a></code> using <code>finalfit</code> grammar. This
produces a table and a plot showing the pattern of missingness between
variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"obstruct.factor"</span>,  
  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"mort_5yr"</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/missing_pattern.html">missing_pattern</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span></code></pre></div>
<p><img src="missing_files/figure-html/unnamed-chunk-6-1.png" width="2187.50001"></p>
<pre><code><span class="co">#&gt;     age sex.factor mort_5yr obstruct.factor smoking_mcar smoking_mar    </span>
<span class="co">#&gt; 617   1          1        1               1            1           1   0</span>
<span class="co">#&gt; 181   1          1        1               1            1           0   1</span>
<span class="co">#&gt; 74    1          1        1               1            0           1   1</span>
<span class="co">#&gt; 22    1          1        1               1            0           0   2</span>
<span class="co">#&gt; 16    1          1        1               0            1           1   1</span>
<span class="co">#&gt; 2     1          1        1               0            1           0   2</span>
<span class="co">#&gt; 2     1          1        1               0            0           1   2</span>
<span class="co">#&gt; 1     1          1        1               0            0           0   3</span>
<span class="co">#&gt; 8     1          1        0               1            1           1   1</span>
<span class="co">#&gt; 4     1          1        0               1            1           0   2</span>
<span class="co">#&gt; 2     1          1        0               1            0           1   2</span>
<span class="co">#&gt;       0          0       14              21          101         210 346</span></code></pre>
<p>This allows us to look for patterns of missingness between variables.
There are 14 patterns in this data. The number and pattern of
missingness help us to determine the likelihood of it being random
rather than systematic.</p>
<div class="section level3">
<h3 id="make-sure-you-include-missing-data-in-demographics-tables">Make sure you include missing data in demographics tables<a class="anchor" aria-label="anchor" href="#make-sure-you-include-missing-data-in-demographics-tables"></a>
</h3>
<p>Table 1 in a healthcare study is often a demographics table of an
“explanatory variable of interest” against other explanatory
variables/confounders. Do not silently drop missing values in this
table. It is easy to do this correctly with summary_factorlist. This
function provides a useful summary of a dependent variable against
explanatory variables. Despite its name, continuous variables are
handled nicely.</p>
<p><code>na_include=TRUE</code> ensures missing data from the
explanatory variables (but not dependent) are included. Note that any
p-values are generated across missing groups as well, so run a second
time with <code>na_include=FALSE</code> if you wish a hypothesis test
only over observed data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Explanatory or confounding variables</span>
<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>,  
  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span><span class="op">)</span>

<span class="co"># Explanatory variable of interest</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"obstruct.factor"</span> <span class="co"># Bowel obstruction</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/summary_factorlist.html">summary_factorlist</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span>, 
  na_include<span class="op">=</span><span class="cn">TRUE</span>, p<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Note: dependent includes missing data. These are dropped.</span>
<span class="co">#&gt;           label     levels          No         Yes     p</span>
<span class="co">#&gt;     Age (years)  Mean (SD) 60.2 (11.5) 57.3 (13.3) 0.004</span>
<span class="co">#&gt;             Sex     Female  346 (47.3)   91 (51.7) 0.330</span>
<span class="co">#&gt;                       Male  386 (52.7)   85 (48.3)      </span>
<span class="co">#&gt;                  (Missing)     0 (0.0)     0 (0.0)      </span>
<span class="co">#&gt;           nodes  Mean (SD)   3.7 (3.7)   3.5 (3.2) 0.435</span>
<span class="co">#&gt;  Smoking (MCAR) Non-smoker  500 (68.3)  130 (73.9) 0.080</span>
<span class="co">#&gt;                     Smoker  154 (21.0)   26 (14.8)      </span>
<span class="co">#&gt;                  (Missing)   78 (10.7)   20 (11.4)      </span>
<span class="co">#&gt;   Smoking (MAR) Non-smoker  467 (63.8)  110 (62.5) 0.077</span>
<span class="co">#&gt;                     Smoker   91 (12.4)   33 (18.8)      </span>
<span class="co">#&gt;                  (Missing)  174 (23.8)   33 (18.8)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="check-for-associations-between-missing-and-observed-data-missing_pairs-missing_compare">4. Check for associations between missing and observed data:
<code>missing_pairs</code> | <code>missing_compare</code><a class="anchor" aria-label="anchor" href="#check-for-associations-between-missing-and-observed-data-missing_pairs-missing_compare"></a>
</h2>
<p>In deciding whether data is MCAR or MAR, one approach is to explore
patterns of missingness between levels of included variables. This is
particularly important (I would say absolutely required) for a primary
outcome measure / dependent variable.</p>
<p>Take for example “death”. When that outcome is missing it is often
for a particular reason. For example, perhaps patients undergoing
emergency surgery were less likely to have complete records compared
with those undergoing planned surgery. And of course, death is more
likely after emergency surgery.</p>
<p><code>missing_pairs</code> uses functions from the excellent <a href="https://ggobi.github.io/ggally/" class="external-link">GGally</a> package. It produces
pairs plots to show relationships between missing values and observed
values in all variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>,  
  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"mort_5yr"</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/missing_pairs.html">missing_pairs</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs1-1024x775.png" class="external-link"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs1-1024x775.png" alt="" width="700"></a></p>
<p>For continuous variables (age and nodes), the distributions of
observed and missing data can be visually compared. Is there a
difference between age and mortality above?</p>
<p>For discrete, data, counts are presented by default. It is often
easier to compare proportions:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/missing_pairs.html">missing_pairs</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span>, position <span class="op">=</span> <span class="st">"fill"</span>, <span class="op">)</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs2-1-1024x733.png" class="external-link"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs2-1-1024x733.png" alt="" width="700"></a></p>
<p>It should be obvious that missingness in Smoking (MCAR) does not
relate to sex (row 6, column 3). But missingness in Smoking (MAR) does
differ by sex (last row, column 3) as was designed above when the
missing data were created.</p>
<p>We can confirm this using <code>missing_compare</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"smoking_mcar"</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/missing_compare.html">missing_compare</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names<span class="op">=</span><span class="cn">FALSE</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Omit when you run</span></code></pre></div>
<table class="table">
<colgroup>
<col width="48%">
<col width="12%">
<col width="15%">
<col width="15%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">Missing data analysis: Smoking (MCAR)</th>
<th align="left"></th>
<th align="right">Not missing</th>
<th align="right">Missing</th>
<th align="right">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="right">59.7 (11.9)</td>
<td align="right">59.9 (12.6)</td>
<td align="right">0.882</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="left">Female</td>
<td align="right">399 (89.7)</td>
<td align="right">46 (10.3)</td>
<td align="right">0.692</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Male</td>
<td align="right">429 (88.6)</td>
<td align="right">55 (11.4)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td align="left">Mean (SD)</td>
<td align="right">3.6 (3.4)</td>
<td align="right">4.0 (4.5)</td>
<td align="right">0.302</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td align="left">No</td>
<td align="right">654 (89.3)</td>
<td align="right">78 (10.7)</td>
<td align="right">0.891</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Yes</td>
<td align="right">156 (88.6)</td>
<td align="right">20 (11.4)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dependent</span> <span class="op">=</span> <span class="st">"smoking_mar"</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/missing_compare.html">missing_compare</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names<span class="op">=</span><span class="cn">FALSE</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Omit when you run</span></code></pre></div>
<table class="table">
<colgroup>
<col width="47%">
<col width="12%">
<col width="15%">
<col width="15%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">Missing data analysis: Smoking (MAR)</th>
<th align="left"></th>
<th align="right">Not missing</th>
<th align="right">Missing</th>
<th align="right">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="right">59.6 (11.9)</td>
<td align="right">60.1 (12.0)</td>
<td align="right">0.597</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="left">Female</td>
<td align="right">288 (64.7)</td>
<td align="right">157 (35.3)</td>
<td align="right">&lt;0.001</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Male</td>
<td align="right">431 (89.0)</td>
<td align="right">53 (11.0)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td align="left">Mean (SD)</td>
<td align="right">3.6 (3.6)</td>
<td align="right">3.8 (3.6)</td>
<td align="right">0.645</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td align="left">No</td>
<td align="right">558 (76.2)</td>
<td align="right">174 (23.8)</td>
<td align="right">0.185</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Yes</td>
<td align="right">143 (81.2)</td>
<td align="right">33 (18.8)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>It takes <code>dependent</code> and <code>explanatory</code>
variables, but in this context <code>dependent</code> just refers to the
variable being tested for missingness against the
<code>explanatory</code> variables.</p>
<p>Comparisons for continuous data use a Kruskal Wallis and for discrete
data a chi-squared test.</p>
<p>As expected, a relationship is seen between Sex and Smoking (MAR) but
not Smoking (MCAR).</p>
<div class="section level3">
<h3 id="for-those-who-like-an-omnibus-test">For those who like an omnibus test<a class="anchor" aria-label="anchor" href="#for-those-who-like-an-omnibus-test"></a>
</h3>
<p>If you are work predominately with numeric rather than discrete data
(categorical/factors), you may find these tests from the MissMech
package useful. The package and output is well documented, and provides
two tests which can be used to determine whether data are MCAR.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ewenharrison/finalfit" class="external-link">finalfit</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MissMech</span><span class="op">)</span>
<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"nodes"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"mort_5yr"</span> 

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">MissMech</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MissMech/man/TestMCARNormality.html" class="external-link">TestMCARNormality</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="decide-how-to-handle-missing-data">5. Decide how to handle missing data<a class="anchor" aria-label="anchor" href="#decide-how-to-handle-missing-data"></a>
</h2>
<p>These <a href="https://www.theanalysisfactor.com/missing-data-mechanism/" class="external-link">pages</a>
from Karen Grace-Martin are great for this.</p>
<p>Prior to a standard regression analysis, we can either:</p>
<ul>
<li>Delete the variable with the missing data</li>
<li>Delete the cases with the missing data</li>
<li>Impute (fill in) the missing data</li>
<li>Model the missing data</li>
</ul>
</div>
<div class="section level2">
<h2 id="mcar-mar-or-mnar">MCAR, MAR, or MNAR<a class="anchor" aria-label="anchor" href="#mcar-mar-or-mnar"></a>
</h2>
<div class="section level3">
<h3 id="mcar-vs-mar">
<strong>MCAR</strong> vs MAR<a class="anchor" aria-label="anchor" href="#mcar-vs-mar"></a>
</h3>
<p>Using the examples, we identify that Smoking (MCAR) is missing
completely at random.</p>
<p>We know nothing about the missing values themselves, but we know of
no plausible reason that the values of the missing data, for say, people
who died should be different to the values of the missing data for those
who survived. The pattern of missingness is therefore not felt to be
MNAR.</p>
<div class="section level4">
<h4 id="common-solution">Common solution<a class="anchor" aria-label="anchor" href="#common-solution"></a>
</h4>
<p>Depending on the number of data points that are missing, we may have
sufficient power with complete cases to examine the relationships of
interest.</p>
<p>We therefore elect to simply omit the patients in whom smoking is
missing. This is known as list-wise deletion and will be performed by
default in standard regression analyses including
<code>finalfit</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>,  
  <span class="st">"smoking_mcar"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"mort_5yr"</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/finalfit.html">finalfit</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names<span class="op">=</span><span class="cn">FALSE</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Omit when you run</span>
<span class="co">#&gt; Note: dependent includes missing data. These are dropped.</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Waiting for profiling to be done...</span></code></pre></div>
<table class="table">
<colgroup>
<col width="24%">
<col width="9%">
<col width="10%">
<col width="10%">
<col width="22%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">Dependent: Mortality 5 year</th>
<th align="left"></th>
<th align="right">Alive</th>
<th align="right">Died</th>
<th align="right">OR (univariable)</th>
<th align="right">OR (multivariable)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="right">59.8 (11.4)</td>
<td align="right">59.9 (12.5)</td>
<td align="right">1.00 (0.99-1.01, p=0.986)</td>
<td align="right">1.01 (1.00-1.02, p=0.200)</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="left">Female</td>
<td align="right">243 (55.6)</td>
<td align="right">194 (44.4)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Male</td>
<td align="right">268 (56.1)</td>
<td align="right">210 (43.9)</td>
<td align="right">0.98 (0.76-1.27, p=0.889)</td>
<td align="right">1.02 (0.76-1.38, p=0.872)</td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td align="left">Mean (SD)</td>
<td align="right">2.7 (2.4)</td>
<td align="right">4.9 (4.4)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
<td align="right">1.25 (1.18-1.33, p&lt;0.001)</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td align="left">No</td>
<td align="right">408 (56.7)</td>
<td align="right">312 (43.3)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Yes</td>
<td align="right">89 (51.1)</td>
<td align="right">85 (48.9)</td>
<td align="right">1.25 (0.90-1.74, p=0.189)</td>
<td align="right">1.53 (1.05-2.22, p=0.027)</td>
</tr>
<tr class="odd">
<td align="left">Smoking (MCAR)</td>
<td align="left">Non-smoker</td>
<td align="right">358 (56.4)</td>
<td align="right">277 (43.6)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Smoker</td>
<td align="right">90 (49.7)</td>
<td align="right">91 (50.3)</td>
<td align="right">1.31 (0.94-1.82, p=0.113)</td>
<td align="right">1.37 (0.96-1.96, p=0.083)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="other-considerations">Other considerations<a class="anchor" aria-label="anchor" href="#other-considerations"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Sensitivity analysis</li>
<li>Omit the variable</li>
<li>Imputation</li>
<li>Model the missing data</li>
</ol>
<p>If the variable in question is thought to be particularly important,
you may wish to perform a sensitivity analysis. A sensitivity analysis
in this context aims to capture the effect of uncertainty on the
conclusions drawn from the model. Thus, you may choose to re-label all
missing smoking values as “smoker”, and see if that changes the
conclusions of your analysis. The same procedure can be performed
labeling with “non-smoker”.</p>
<p>If smoking is not associated with the explanatory variable of
interest (bowel obstruction) or the outcome, it may be considered not to
be a confounder and so could be omitted. That neatly deals with the
missing data issue, but of course may not be appropriate.</p>
<p>Imputation and modelling are considered below.</p>
</div>
</div>
<div class="section level3">
<h3 id="mcar-vs-mar-1">MCAR vs <strong>MAR</strong><a class="anchor" aria-label="anchor" href="#mcar-vs-mar-1"></a>
</h3>
<p>But life is rarely that simple.</p>
<p>Consider that the smoking variable is more likely to be missing if
the patient is female (missing_compareshows a relationship). But, say,
that the missing values are not different from the observed values.
Missingness is then MAR.</p>
<p>If we simply drop all the cases (patients) in which smoking is
missing (list-wise deletion), then proportionally we drop more females
than men. This may have consequences for our conclusions if sex is
associated with our explanatory variable of interest or outcome.</p>
<div class="section level4">
<h4 id="common-solution-1">Common solution<a class="anchor" aria-label="anchor" href="#common-solution-1"></a>
</h4>
<p><a href="https://github.com/amices/mice" class="external-link">mice</a> is our go to
package for multiple imputation. That’s the process of filling in
missing data using a best-estimate from all the other data that exists.
When first encountered, this may not sound like a good idea.</p>
<p>However, taking our simple example, if missingness in smoking is
predicted strongly by sex (and other observed variables), and the values
of the missing data are random, then we can impute (best-guess) the
missing smoking values using sex and other variables in the dataset.</p>
<p>Imputation is not usually appropriate for the explanatory variable of
interest or the outcome variable. In both case, the hypothesis is that
there is an meaningful association with other variables in the dataset,
therefore it doesn’t make sense to use these variables to impute
them.</p>
<p>Here is some code to run <code>mice</code>. The package is well
documented, and there are a number of checks and considerations that
should be made to inform the imputation process. Read the documentation
carefully prior to doing this yourself.</p>
<p>Note also <code><a href="../reference/missing_predictorMatrix.html">finalfit::missing_predictorMatrix()</a></code>. This
provides an easy way to include or exclude variables to be imputed or to
be used for imputation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Multivariate Imputation by Chained Equations (mice)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ewenharrison/finalfit" class="external-link">finalfit</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span>
<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>, <span class="st">"smoking_mar"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">"mort_5yr"</span>

<span class="co"># Choose whether to impute missing values</span>
<span class="co"># from particular variables, e.g. explanatory variable of interest</span>
<span class="co"># or outcome variable. </span>
<span class="co"># Outcome often imputed as best practice, dropped here for demonstration. </span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/missing_predictorMatrix.html">missing_predictorMatrix</a></span><span class="op">(</span>
        drop_from_imputed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mort_5yr"</span><span class="op">)</span>,
        drop_from_imputer <span class="op">=</span> <span class="st">""</span>
        <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">predM</span>

<span class="co"># This is needed to drop from imputed</span>
<span class="va">m0</span> <span class="op">=</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span>, maxit<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="va">m0</span><span class="op">$</span><span class="va">method</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mort_5yr"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">""</span>

<span class="va">fits</span> <span class="op">=</span> <span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Usually run imputation with 10 imputed sets, 4 here for demonstration</span>
  <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">4</span>, predictorMatrix <span class="op">=</span> <span class="va">predM</span>, method <span class="op">=</span> <span class="va">m0</span><span class="op">$</span><span class="va">method</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Run logistic regression on each imputed set</span>
  <span class="fu"><a href="https://amices.org/mice/reference/with.mids.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="fu"><a href="../reference/ff_formula.html">ff_formula</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span><span class="op">)</span>, 
    family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  iter imp variable</span>
<span class="co">#&gt;   1   1  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   1   2  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   1   3  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   1   4  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   2   1  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   2   2  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   2   3  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   2   4  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   3   1  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   3   2  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   3   3  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   3   4  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   4   1  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   4   2  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   4   3  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   4   4  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   5   1  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   5   2  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   5   3  nodes  obstruct.factor  smoking_mar</span>
<span class="co">#&gt;   5   4  nodes  obstruct.factor  smoking_mar</span>

<span class="co"># Examples of extracting metrics from fits</span>
<span class="co">## AICs</span>
<span class="va">fits</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://amices.org/mice/reference/getfit.html" class="external-link">getfit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">AIC</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 1172.373</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 1170.95</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 1168.909</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] 1172.158</span>

<span class="co"># C-statistic</span>
<span class="va">fits</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://amices.org/mice/reference/getfit.html" class="external-link">getfit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">y</span>, <span class="va">.x</span><span class="op">$</span><span class="va">fitted</span><span class="op">)</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; Area under the curve: 0.6841</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; Area under the curve: 0.6864</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; Area under the curve: 0.6847</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; Area under the curve: 0.6839</span>

  
<span class="co"># Pool  results</span>
<span class="va">fits_pool</span> <span class="op">=</span> <span class="va">fits</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://amices.org/mice/reference/pool.html" class="external-link">pool</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Can be passed to or_plot</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/or_plot.html">or_plot</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span>, glmfit <span class="op">=</span> <span class="va">fits_pool</span>, table_text_size<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<p><img src="missing_files/figure-html/unnamed-chunk-14-1.png" width="3000"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Summarise and put in table</span>
<span class="va">fit_imputed</span> <span class="op">=</span> <span class="va">fits_pool</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                  
    <span class="fu"><a href="../reference/fit2df.html">fit2df</a></span><span class="op">(</span>estimate_name <span class="op">=</span> <span class="st">"OR (multiple imputation)"</span>, exp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Use finalfit merge methods to create and compare results</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/summary_factorlist.html">summary_factorlist</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span>, fit_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">summary1</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/glmuni.html">glmuni</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/fit2df.html">fit2df</a></span><span class="op">(</span>estimate_suffix <span class="op">=</span> <span class="st">" (univariable)"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">fit_uni</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/glmmulti.html">glmmulti</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/fit2df.html">fit2df</a></span><span class="op">(</span>estimate_suffix <span class="op">=</span> <span class="st">" (multivariable inc. smoking)"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">fit_multi</span>

<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span><span class="op">)</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/glmmulti.html">glmmulti</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/fit2df.html">fit2df</a></span><span class="op">(</span>estimate_suffix <span class="op">=</span> <span class="st">" (multivariable)"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">fit_multi_r</span>

<span class="co"># Combine to final table</span>
<span class="va">summary1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ff_merge.html">ff_merge</a></span><span class="op">(</span><span class="va">fit_uni</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ff_merge.html">ff_merge</a></span><span class="op">(</span><span class="va">fit_multi_r</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ff_merge.html">ff_merge</a></span><span class="op">(</span><span class="va">fit_multi</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ff_merge.html">ff_merge</a></span><span class="op">(</span><span class="va">fit_imputed</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">fit_id</span>, <span class="op">-</span><span class="va">index</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names<span class="op">=</span><span class="cn">FALSE</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>,<span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="16%">
<col width="16%">
<col width="20%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">label</th>
<th align="left">levels</th>
<th align="right">Alive</th>
<th align="right">Died</th>
<th align="right">OR (univariable)</th>
<th align="right">OR (multivariable)</th>
<th align="right">OR (multivariable inc. smoking)</th>
<th align="right">OR (multiple imputation)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="right">59.8 (11.4)</td>
<td align="right">59.9 (12.5)</td>
<td align="right">1.00 (0.99-1.01, p=0.986)</td>
<td align="right">1.01 (1.00-1.02, p=0.122)</td>
<td align="right">1.02 (1.00-1.03, p=0.010)</td>
<td align="right">1.01 (1.00-1.02, p=0.180)</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="left">Female</td>
<td align="right">243 (47.6)</td>
<td align="right">194 (48.0)</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Male</td>
<td align="right">268 (52.4)</td>
<td align="right">210 (52.0)</td>
<td align="right">0.98 (0.76-1.27, p=0.889)</td>
<td align="right">0.98 (0.74-1.30, p=0.890)</td>
<td align="right">0.88 (0.64-1.23, p=0.461)</td>
<td align="right">1.01 (0.77-1.33, p=0.940)</td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td align="left">Mean (SD)</td>
<td align="right">2.7 (2.4)</td>
<td align="right">4.9 (4.4)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
<td align="right">1.25 (1.19-1.32, p&lt;0.001)</td>
<td align="right">1.25 (1.18-1.33, p&lt;0.001)</td>
<td align="right">1.24 (1.18-1.31, p&lt;0.001)</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td align="left">No</td>
<td align="right">408 (82.1)</td>
<td align="right">312 (78.6)</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Yes</td>
<td align="right">89 (17.9)</td>
<td align="right">85 (21.4)</td>
<td align="right">1.25 (0.90-1.74, p=0.189)</td>
<td align="right">1.36 (0.95-1.93, p=0.089)</td>
<td align="right">1.26 (0.85-1.88, p=0.252)</td>
<td align="right">1.38 (0.97-1.95, p=0.072)</td>
</tr>
<tr class="odd">
<td align="left">Smoking (MAR)</td>
<td align="left">Non-smoker</td>
<td align="right">328 (82.8)</td>
<td align="right">254 (81.2)</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Smoker</td>
<td align="right">68 (17.2)</td>
<td align="right">59 (18.8)</td>
<td align="right">1.12 (0.76-1.65, p=0.563)</td>
<td align="right">-</td>
<td align="right">1.25 (0.82-1.89, p=0.300)</td>
<td align="right">1.21 (0.80-1.84, p=0.359)</td>
</tr>
</tbody>
</table>
<p>The final table can easily be exported to Word or as a PDF as
described in the “Export” vignette.</p>
<p>By examining the coefficients, the effect of the imputation compared
with the complete case analysis can be clearly seen.</p>
</div>
<div class="section level4">
<h4 id="other-considerations-1">Other considerations<a class="anchor" aria-label="anchor" href="#other-considerations-1"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Omit the variable</li>
<li>Imputing factors with new level for missing data</li>
<li>Model the missing data</li>
</ol>
<p>As above, if the variable does not appear to be important, it may be
omitted from the analysis. A sensitivity analysis in this context is
another form of imputation. But rather than using all other available
information to best-guess the missing data, we simply assign the value
as above. Imputation is therefore likely to be more appropriate.</p>
<p>There is an alternative method to model the missing data for the
categorical in this setting – just consider the missing data as a factor
level. This has the advantage of simplicity, with the disadvantage of
increasing the number of terms in the model. Multiple imputation is
generally preferred.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex.factor"</span>, 
  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>, <span class="st">"smoking_mar"</span><span class="op">)</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    smoking_mar <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_na_value_to_level.html" class="external-link">fct_na_value_to_level</a></span><span class="op">(</span><span class="va">smoking_mar</span>, level <span class="op">=</span> <span class="st">"(Missing)"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/finalfit.html">finalfit</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names<span class="op">=</span><span class="cn">FALSE</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="24%">
<col width="9%">
<col width="10%">
<col width="10%">
<col width="22%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">Dependent: Mortality 5 year</th>
<th align="left"></th>
<th align="right">Alive</th>
<th align="right">Died</th>
<th align="right">OR (univariable)</th>
<th align="right">OR (multivariable)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="right">59.8 (11.4)</td>
<td align="right">59.9 (12.5)</td>
<td align="right">1.00 (0.99-1.01, p=0.986)</td>
<td align="right">1.01 (1.00-1.02, p=0.119)</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="left">Female</td>
<td align="right">243 (55.6)</td>
<td align="right">194 (44.4)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Male</td>
<td align="right">268 (56.1)</td>
<td align="right">210 (43.9)</td>
<td align="right">0.98 (0.76-1.27, p=0.889)</td>
<td align="right">0.96 (0.72-1.30, p=0.809)</td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td align="left">Mean (SD)</td>
<td align="right">2.7 (2.4)</td>
<td align="right">4.9 (4.4)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
<td align="right">1.25 (1.19-1.32, p&lt;0.001)</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td align="left">No</td>
<td align="right">408 (56.7)</td>
<td align="right">312 (43.3)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Yes</td>
<td align="right">89 (51.1)</td>
<td align="right">85 (48.9)</td>
<td align="right">1.25 (0.90-1.74, p=0.189)</td>
<td align="right">1.34 (0.94-1.91, p=0.102)</td>
</tr>
<tr class="odd">
<td align="left">Smoking (MAR)</td>
<td align="left">Non-smoker</td>
<td align="right">328 (56.4)</td>
<td align="right">254 (43.6)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Smoker</td>
<td align="right">68 (53.5)</td>
<td align="right">59 (46.5)</td>
<td align="right">1.12 (0.76-1.65, p=0.563)</td>
<td align="right">1.24 (0.82-1.88, p=0.308)</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">(Missing)</td>
<td align="right">115 (55.8)</td>
<td align="right">91 (44.2)</td>
<td align="right">1.02 (0.74-1.41, p=0.895)</td>
<td align="right">0.99 (0.69-1.41, p=0.943)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="mnar-vs-mar">
<strong>MNAR</strong> vs MAR<a class="anchor" aria-label="anchor" href="#mnar-vs-mar"></a>
</h3>
<p>Missing not at random data is tough in healthcare. To determine if
data are MNAR for definite, we need to know their value in a subset of
observations (patients).</p>
<p>Using our example above. Say smoking status is poorly recorded in
patients admitted to hospital as an emergency with an obstructing
cancer. Obstructing bowel cancers may be larger or their position may
make the prognosis worse. Smoking may relate to the aggressiveness of
the cancer and may be an independent predictor of prognosis. The missing
values for smoking may therefore not be random. Smoking may be more
common in the emergency patients and may be more common in those that
die.</p>
<p>There is no easy way to handle this. If at all possible, try to get
the missing data. Otherwise, take care when drawing conclusions from
analyses where data are thought to be missing not at random.</p>
</div>
</div>
<div class="section level2">
<h2 id="where-to-next">Where to next<a class="anchor" aria-label="anchor" href="#where-to-next"></a>
</h2>
<p>We are now doing more in Stan. Missing data can be imputed directly
within a Stan model which feels neat. Stan doesn’t yet have the
equivalent of <code>NA</code> which makes passing the data block into
Stan a bit of a faff.</p>
<p>Alternatively, the missing data can be directly modelled in Stan.
Examples are provided in the manual. Again, I haven’t found this that
easy to do, but there are a number of Stan developments that will
hopefully make this more straightforward in the future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ewen Harrison, Tom Drake, Riinu Pius.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

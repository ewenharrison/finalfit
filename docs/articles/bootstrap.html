<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bootstrap simulation for model prediction • finalfit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bootstrap simulation for model prediction">
<meta property="og:description" content="finalfit">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">finalfit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/finalfit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/all_plots_examples.html">All plots examples</a>
    </li>
    <li>
      <a href="../articles/all_tables_examples.html">All tables examples</a>
    </li>
    <li>
      <a href="../articles/bootstrap.html">Bootstrap simulation for model prediction</a>
    </li>
    <li>
      <a href="../articles/data_prep.html">Preparing data for finalfit</a>
    </li>
    <li>
      <a href="../articles/export.html">Exporting tables and plots</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Time-to-event (Survival)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ewenharrison/finalfit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bootstrap simulation for model prediction</h1>
                        <h4 data-toc-skip class="author">Ewen
Harrison</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ewenharrison/finalfit/blob/HEAD/vignettes/bootstrap.Rmd" class="external-link"><code>vignettes/bootstrap.Rmd</code></a></small>
      <div class="hidden name"><code>bootstrap.Rmd</code></div>

    </div>

    
    
<p>I’ve always been a fan of converting model outputs to real-life
quantities of interest. For example, I like to supplement a logistic
regression model table with predicted probabilities for a given set of
explanatory variable levels. This can be more intuitive than odds
ratios, particularly for a lay audience.</p>
<p>For example, say I have run a logistic regression model for predicted
5 year survival after colon cancer. What is the actual probability of
death for a patient under 40 with a small cancer that has not
perforated? How does that probability differ for a patient over 40?</p>
<p>I’ve tried this various ways. I used <a href="https://zeligproject.org/" class="external-link">Zelig</a> for a while including <a href="https://www.bmj.com/content/344/bmj.e3330" class="external-link">here</a>, but it
started trying to do too much and was always broken (I updated it the
other day in the hope that things were better, but was met with a string
of errors again).</p>
<p>I also used <a href="https://CRAN.R-project.org/package=rms" class="external-link">rms</a>,
including <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0148782" class="external-link">here</a>
(checkout the nice plots!). I like it and respect the package. But I
don’t use it as standard and so need to convert all the models first,
e.g. to lrm. Again, for my needs it tries to do too much and I find
datadist awkward.</p>
<p>Thirdly, I love <a href="https://mc-stan.org/users/interfaces/rstan" class="external-link">Stan</a> for this,
e.g. used in this <a href="https://doi.org/10.1016/S1473-3099(18)30101-4" class="external-link">paper</a>. The
generated quantities block allows great flexibility to simulate whatever
you wish from the posterior. I’m a Bayesian at heart will always come
back to this. But for some applications it’s a bit much, and takes some
time to get running as I want.</p>
<p>I often simply want to predict y-hat from lm and glm with
bootstrapped intervals and ideally a comparison of explanatory levels
sets. Just like <code>sim</code> does in <code>Zelig</code>. But I want
it in a format I can immediately use in a publication.</p>
<p>Well now I can with <code>finalfit</code></p>
<p>There’s two main functions with some new internals to help expand to
other models in the future.</p>
<p>Make sure you are on the most up-to-date version of finalfit.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"finalfit"</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="create-new-dataframe-of-explanatory-variable-levels">Create new dataframe of explanatory variable levels<a class="anchor" aria-label="anchor" href="#create-new-dataframe-of-explanatory-variable-levels"></a>
</h2>
<p><code>ff_newdata</code> (alias: <code>finalfit_newdata</code>) is
used to generate a new dataframe. See the next section for an
alternative approach to doing this. I usually want to set 4 or 5
combinations of <code>x</code> levels and often find it difficult to get
this formatted correctly to use with <code>predict</code>. Pass the
original dataset, the names of explanatory variables used in the model,
and a list of levels for these. For the latter, they can be included as
rows or columns. If the data type is incorrect or you try to pass factor
levels that don’t exist, it will fail with a useful warning.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ewenharrison/finalfit" class="external-link">finalfit</a></span><span class="op">)</span>
<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age.factor"</span>, <span class="st">"extent.factor"</span>, <span class="st">"perfor.factor"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">'mort_5yr'</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/ff_newdata.html">finalfit_newdata</a></span><span class="op">(</span>explanatory <span class="op">=</span> <span class="va">explanatory</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;40 years"</span>,  <span class="st">"Submucosa"</span>, <span class="st">"No"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;40 years"</span>, <span class="st">"Submucosa"</span>, <span class="st">"Yes"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;40 years"</span>, <span class="st">"Adjacent structures"</span>, <span class="st">"No"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;40 years"</span>, <span class="st">"Adjacent structures"</span>, <span class="st">"Yes"</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">newdata</span>
<span class="va">newdata</span>
<span class="co">#&gt;   age.factor       extent.factor perfor.factor</span>
<span class="co">#&gt; 1  &lt;40 years           Submucosa            No</span>
<span class="co">#&gt; 2  &lt;40 years           Submucosa           Yes</span>
<span class="co">#&gt; 3  &lt;40 years Adjacent structures            No</span>
<span class="co">#&gt; 4  &lt;40 years Adjacent structures           Yes</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ff_expand-for-creating-new-data-frame">
<code>ff_expand()</code> for creating new data frame<a class="anchor" aria-label="anchor" href="#ff_expand-for-creating-new-data-frame"></a>
</h2>
<p><code><a href="../reference/ff_expand.html">ff_expand()</a></code> has been added to aid in setting up new data
frames for model prediction. It uses two further functions
(<code><a href="../reference/ff_mode.html">ff_mode()</a></code> and <code><a href="../reference/summary_df.html">summary_df()</a></code>) to generate a
data frame which includes the mode of factors (most frequent occurrence
of a factor level) and the mean or median of numeric variables, together
with an expansion of specified factors to include all combinations of
their levels.</p>
<p>This is commonly needed when simulating model predictions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/ff_expand.html">ff_expand</a></span><span class="op">(</span><span class="va">age.factor</span>, <span class="va">sex.factor</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 31</span></span>
<span class="co">#&gt;   age.factor  sex.factor    id rx      sex   age obstruct perfor adhere nodes</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> &lt;40 years   Female       465 Obs   0.521  59.8    0.194 0.029<span style="text-decoration: underline;">1</span>  0.145  3.66</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> &lt;40 years   Male         465 Obs   0.521  59.8    0.194 0.029<span style="text-decoration: underline;">1</span>  0.145  3.66</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40-59 years Female       465 Obs   0.521  59.8    0.194 0.029<span style="text-decoration: underline;">1</span>  0.145  3.66</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 40-59 years Male         465 Obs   0.521  59.8    0.194 0.029<span style="text-decoration: underline;">1</span>  0.145  3.66</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 60+ years   Female       465 Obs   0.521  59.8    0.194 0.029<span style="text-decoration: underline;">1</span>  0.145  3.66</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 60+ years   Male         465 Obs   0.521  59.8    0.194 0.029<span style="text-decoration: underline;">1</span>  0.145  3.66</span>
<span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more variables: status &lt;dbl&gt;, differ &lt;dbl&gt;, extent &lt;dbl&gt;, surg &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   node4 &lt;dbl&gt;, time &lt;dbl&gt;, rx.factor &lt;fct&gt;, obstruct.factor &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   perfor.factor &lt;fct&gt;, adhere.factor &lt;fct&gt;, differ.factor &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   extent.factor &lt;fct&gt;, surg.factor &lt;fct&gt;, node4.factor &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   status.factor &lt;fct&gt;, loccomp &lt;dbl&gt;, loccomp.factor &lt;fct&gt;, time.years &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mort_5yr &lt;fct&gt;, age.10 &lt;dbl&gt;, mort_5yr.num &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-bootstrap-simulations-of-model-predictions">Run bootstrap simulations of model predictions<a class="anchor" aria-label="anchor" href="#run-bootstrap-simulations-of-model-predictions"></a>
</h2>
<p><code>boot_predict</code> takes standard <code>lm</code> and
<code>glm</code> model objects, together with <code>finalfit</code>
<code>lmlist</code> and <code>glmlist</code> objects from fitters,
e.g. <code>lmmulti</code> and <code>glmmulti</code>. In addition, it
requires a <code>newdata</code> object generated from
<code>ff_newdata</code>. If you’re new to this, don’t be put off by all
those model acronyms, it is straightforward.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/glmmulti.html">glmmulti</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/boot_predict.html">boot_predict</a></span><span class="op">(</span><span class="va">newdata</span>, 
    estimate_name <span class="op">=</span> <span class="st">"Predicted probability of death"</span>,
    R<span class="op">=</span><span class="fl">100</span>, boot_compare <span class="op">=</span> <span class="cn">FALSE</span>,
    digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;         Age    Extent of spread Perforation Predicted probability of death</span>
<span class="co">#&gt; 1 &lt;40 years           Submucosa          No            0.28 (0.04 to 0.57)</span>
<span class="co">#&gt; 2 &lt;40 years           Submucosa         Yes            0.29 (0.03 to 0.70)</span>
<span class="co">#&gt; 3 &lt;40 years Adjacent structures          No            0.71 (0.50 to 0.86)</span>
<span class="co">#&gt; 4 &lt;40 years Adjacent structures         Yes            0.72 (0.39 to 0.92)</span></code></pre></div>
<p>Note that the number of simulations (<code>R</code>) here is low for
demonstration purposes. You should expect to use 1000 to 10000 to ensure
you have stable estimates.</p>
</div>
<div class="section level2">
<h2 id="output-to-word-pdf-and-html-via-rmarkdown">Output to Word, PDF, and html via RMarkdown<a class="anchor" aria-label="anchor" href="#output-to-word-pdf-and-html-via-rmarkdown"></a>
</h2>
<p>Simulations are produced using bootstrapping and everything is tidily
outputted in a table/dataframe, which can be passed to
<code><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">knitr::kable</a></code>.</p>
<p>Place this chunk in an .Rmd file:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">table</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/table1_boot-1024x225.png" class="external-link"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/table1_boot-1024x225.png" alt="" width="600" class="aligncenter"></a></p>
</div>
<div class="section level2">
<h2 id="make-comparisons">Make comparisons<a class="anchor" aria-label="anchor" href="#make-comparisons"></a>
</h2>
<p>Better still, by including <code>boot_compare=TRUE</code> (default),
comparisons are made between the first row of newdata and each
subsequent row. These can be first differences (e.g. absolute risk
differences) or ratios (e.g. relative risk ratios). The comparisons are
done on the individual bootstrap predictions and the distribution
summarised as a mean with percentile confidence intervals (95% CI as
default, e.g. 2.5 and 97.5 percentiles). A p-value is generated on the
proportion of values on the other side of the null from the mean,
e.g. for a ratio greater than 1.0, p is the number of bootstrapped
predictions under 1.0. Multiplied by two so it is two-sided.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/glmmulti.html">glmmulti</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/boot_predict.html">boot_predict</a></span><span class="op">(</span><span class="va">newdata</span>, 
    estimate_name <span class="op">=</span> <span class="st">"Predicted probability of death"</span>,
    <span class="co">#compare_name = "Absolute risk difference",</span>
    R<span class="op">=</span><span class="fl">100</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;         Age    Extent of spread Perforation Predicted probability of death</span>
<span class="co">#&gt; 1 &lt;40 years           Submucosa          No            0.28 (0.02 to 0.59)</span>
<span class="co">#&gt; 2 &lt;40 years           Submucosa         Yes            0.29 (0.01 to 0.65)</span>
<span class="co">#&gt; 3 &lt;40 years Adjacent structures          No            0.71 (0.47 to 0.89)</span>
<span class="co">#&gt; 4 &lt;40 years Adjacent structures         Yes            0.72 (0.30 to 0.91)</span>
<span class="co">#&gt;                       Difference</span>
<span class="co">#&gt; 1                              -</span>
<span class="co">#&gt; 2 -0.00 (-0.16 to 0.16, p=0.980)</span>
<span class="co">#&gt; 3   0.43 (0.14 to 0.71, p&lt;0.001)</span>
<span class="co">#&gt; 4   0.42 (0.06 to 0.73, p=0.020)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="what-is-not-included">What is not included?<a class="anchor" aria-label="anchor" href="#what-is-not-included"></a>
</h2>
<p>It doesn’t yet include our other common models, such as
<code>coxph</code> which I may add in. It doesn’t do <code>lmer</code>
or <code>glmer</code> either. <code>bootMer</code> works well
mixed-effects models which take a bit more care and thought, e.g. how
are random effects to be handled in the simulations. So I don’t have
immediate plans to add that in, better to do directly.</p>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<p>Finally, as with all finalfit functions, results can be produced as
individual variables using <code>condense == FALSE</code>. This is
particularly useful for plotting.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ewenharrison/finalfit" class="external-link">finalfit</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">explanatory</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nodes"</span>, <span class="st">"extent.factor"</span>, <span class="st">"perfor.factor"</span><span class="op">)</span>
<span class="va">dependent</span> <span class="op">=</span> <span class="st">'mort_5yr'</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/ff_newdata.html">finalfit_newdata</a></span><span class="op">(</span>explanatory <span class="op">=</span> <span class="va">explanatory</span>, rowwise <span class="op">=</span> <span class="cn">FALSE</span>,
    newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Muscle"</span>, <span class="fl">62</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Adjacent structures"</span>, <span class="fl">62</span><span class="op">)</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="fl">31</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>, <span class="fl">31</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="fl">31</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>, <span class="fl">31</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">newdata</span>

<span class="va">colon_s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/glmmulti.html">glmmulti</a></span><span class="op">(</span><span class="va">dependent</span>, <span class="va">explanatory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/boot_predict.html">boot_predict</a></span><span class="op">(</span><span class="va">newdata</span>, boot_compare <span class="op">=</span> <span class="cn">FALSE</span>, 
  R<span class="op">=</span><span class="fl">100</span>, condense<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nodes</span>, y <span class="op">=</span> <span class="va">estimate</span>, ymin <span class="op">=</span> <span class="va">estimate_conf.low</span>,
      ymax <span class="op">=</span> <span class="va">estimate_conf.high</span>, fill<span class="op">=</span><span class="va">extent.factor</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">extent.factor</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">perfor.factor</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Number of postive lymph nodes"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability of death"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Extent of tumour"</span>, colour <span class="op">=</span> <span class="st">"Extent of tumour"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Probability of death by lymph node count"</span><span class="op">)</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/simulation_plot-1024x567.png" class="external-link"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/simulation_plot-1024x567.png" alt="" width="600" class="aligncenter"></a></p>
<p>So there you have it. Straightforward bootstrapped simulations of
model predictions, together with comparisons and easy plotting.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ewen Harrison, Tom Drake, Riinu Pius.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
